(()=>{"use strict";globalThis.onUiLoaded((()=>{console.log("ui loaded");let e=["txt2img","img2img"],t=["textual_inversion","hypernetworks","checkpoints","lora"],o="cards";function l(){var l;let n=getTranslation("replace preview");n||(n="replace preview");let r="",a=null,i=null,c=null,s="",d="",g=null,u=!1,p=getActiveTabType();p||(p="txt2img");for(const n of e){if(n!=p)continue;let e="";globalThis.gradioApp().getElementById(n+"_extra_tabs")||console.log("can not find extra_tabs: "+n+"_extra_tabs");const m=null===(l=Array.from(globalThis.get_uiCurrentTabContent().querySelectorAll(".extra-network-cards,.extra-network-thumbs")).find((e=>"block"===e.closest(".tabitem").style.display)))||void 0===l?void 0:l.id.match(/^(txt2img|img2img)_(.+)_cards$/)[2];switch(console.log("found active tab: "+m),m){case"textual_inversion":e="ti";break;case"hypernetworks":e="hyper";break;case"checkpoints":e="ckp";break;case"lora":e="lora"}for(const l of t){switch(l){case"textual_inversion":d="ti";break;case"hypernetworks":d="hyper";break;case"checkpoints":d="ckp";break;case"lora":d="lora"}if(d){if(d==e){console.log("handle active extra tab"),r=n+"_"+l+"_"+o,a=globalThis.gradioApp().getElementById(r),g=a.querySelectorAll(".card");for(let e of g){if(i=e.querySelector(".button-row"),!i){console.log("can not find button_row");continue}let t=i.querySelectorAll("a");if(t&&t.length?console.log("find atags: "+t.length):(console.log("no atags"),u=!0),!u){console.log("do not need to add buttons");continue}if(c=e.querySelector(".actions .additional .search_term"),!c){console.log("can not find search_term node for cards in "+r);continue}if(s=c.innerHTML.trim(),!s){console.log("search_term is empty for cards in "+r);continue}console.log("adding buttons");let o=document.createElement("a");o.href="#",o.innerHTML="üåê",o.className="card-button",o.title="Open this model's civitai url",o.setAttribute("onclick","open_model_url(event, '"+d+"', '"+s+"')");let l=document.createElement("a");l.href="#",l.innerHTML="üí°",l.className="card-button",l.title="Add trigger words to prompt",l.setAttribute("onclick","add_trigger_words(event, '"+d+"', '"+s+"')");let n=document.createElement("a");n.href="#",n.innerHTML="üè∑Ô∏è",n.className="card-button",n.title="Use prompt from preview image",n.setAttribute("onclick","use_preview_prompt(event, '"+d+"', '"+s+"')");let a=document.createElement("a");a.href="#",a.innerHTML="‚ùå",a.className="card-button",a.title="Remove this model",a.setAttribute("onclick","remove_card(event, '"+d+"', '"+s+"')"),i.appendChild(o),i.appendChild(l),i.appendChild(n),i.appendChild(a)}}}else console.log("can not get model_type from: "+l)}}}function n(){console.log("start update_card_for_civitai_with_sd1_8");let l=getTranslation("replace preview");l||(l="replace preview");let n="",r=null,a=null,i=null,c="",s="",d=null,g=!1,u=null,p=null,m="",_="",f=getActiveTabType();f||(f="txt2img");for(const l of e)if(l==f){u=globalThis.gradioApp().getElementById(l+"_extra_tabs"),u||console.log("can not find extra_tabs: "+l+"_extra_tabs");for(const e of t){let t=globalThis.gradioApp().getElementById(l+"_"+e);if(null!=t){if("block"==t.style.display){p=t,m=e;break}}else console.log(`can not get extra_tab: ${l}_${e}`)}switch(console.log("found active_model_type: "+m),m){case"textual_inversion":_="ti",s="ti";break;case"hypernetworks":_="hyper",s="hyper";break;case"checkpoints":_="ckp",s="ckp";break;case"lora":_="lora",s="lora"}if(s){console.log("handle active extra tab"),n=l+"_"+m+"_"+o,r=globalThis.gradioApp().getElementById(n),d=r.querySelectorAll(".card"),console.log(`get cards: ${d.length}`);for(let e of d){if(console.log(`current card: ${e.dataset.name}`),a=e.querySelector(".button-row"),a.style.flexWrap="wrap",!a){console.log("can not find button_row");continue}let t=a.querySelectorAll("a");if(t&&t.length?console.log("find atags: "+t.length):g=!0,!g){console.log("no need to add buttons");continue}if(i=e.querySelector(".actions .additional .search_terms"),!i){console.log("can not find search_term node for cards in "+n);continue}if(c=i.innerHTML.trim(),!c){console.log("search_term is empty for cards in "+n);continue}c=c.replaceAll("\\","\\\\"),console.log("adding buttons");let o=document.createElement("a");o.href="#",o.innerHTML="üåê",o.className="card-button",o.title="Open this model's civitai url",o.setAttribute("onclick","open_model_url(event, '"+s+"', '"+c+"')");let l=document.createElement("a");l.href="#",l.innerHTML="üí°",l.className="card-button",l.title="Add trigger words to prompt",l.setAttribute("onclick","add_trigger_words(event, '"+s+"', '"+c+"')");let r=document.createElement("a");r.href="#",r.innerHTML="üè∑Ô∏è",r.className="card-button",r.title="Use prompt from preview image",r.setAttribute("onclick","use_preview_prompt(event, '"+s+"', '"+c+"')");let d=document.createElement("a");d.href="#",d.innerHTML="‚ùå",d.className="card-button",d.title="Remove this model",d.setAttribute("onclick","remove_card(event, '"+s+"', '"+c+"')"),a.appendChild(o),a.appendChild(l),a.appendChild(r),a.appendChild(d)}}else console.log("can not get model_type with: "+m)}console.log("end update_card_for_civitai_with_sd1_8")}let r="",a="",i="",c=null,s=null,d=null,g=null,u=ch_sd_version();if(console.log(`sd version is: ${u}`),u>="1.8.0")for(let o of e){a=o+"_lora_controls";for(const e of t)a=o+"_"+e+"_controls",d=globalThis.gradioApp().getElementById(a),i=o+"_"+e+"_extra_refresh",c=globalThis.gradioApp().getElementById(i),c?c.onclick=function(t){console.log("run refresh button on click"),globalThis.extraNetworksControlRefreshOnClick(t,o,e),n()}:console.log("can not find refresh_btn with id: "+i)}else{for(let t of e){if(r=t+"_extra_tabs",s=globalThis.gradioApp().getElementById(r),g=globalThis.gradioApp().getElementById("txt2img_lora_extra_refresh"),console.log("get extra_network_refresh_btn: "+g),!g){console.log("can not get extra network refresh button for "+r);continue}let e=document.createElement("button");e.innerHTML="üîÅ",e.title="Refresh Civitai Helper's additional buttons",e.className="lg secondary gradio-button",e.style.fontSize="200%",e.onclick=l,g.parentNode.appendChild(e)}l()}}))})();