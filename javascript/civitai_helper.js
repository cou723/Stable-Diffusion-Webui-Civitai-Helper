(()=>{"use strict";var e={624:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ch_sd_version=void 0,t.ch_sd_version=function(){let e=gradioApp().getElementById("footer");if(!e)return null;let t=e.querySelector(".versions");if(!t)return null;let[o]=t.getElementsByTagName("a");return o?o.innerHTML.substring(1).match(/v[0-9]\.[0-9]\.[0-9]/)[0]:null}},807:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getActiveTabType=void 0,t.getActiveTabType=function(){switch(get_uiCurrentTabContent().id){case"tab_txt2img":return"txt2img";case"tab_img2img":return"img2img"}return null}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var l=t[n]={exports:{}};return e[n](l,l.exports,o),l.exports}(()=>{const e=o(624),t=o(807);onUiLoaded((()=>{console.log("ui loaded");let o=["txt2img","img2img"],n=["textual_inversion","hypernetworks","checkpoints","lora"],r="cards";function l(){var e;let l=getTranslation("replace preview");l||(l="replace preview");let a="",i=null,c=null,s=null,d="",u="",g=null,p=!1,_=(0,t.getActiveTabType)();_||(_="txt2img");for(const t of o){if(t!=_)continue;let o="";gradioApp().getElementById(t+"_extra_tabs")||console.log("can not find extra_tabs: "+t+"_extra_tabs");const l=null===(e=Array.from(get_uiCurrentTabContent().querySelectorAll(".extra-network-cards,.extra-network-thumbs")).find((e=>"block"===e.closest(".tabitem").style.display)))||void 0===e?void 0:e.id.match(/^(txt2img|img2img)_(.+)_cards$/)[2];switch(console.log("found active tab: "+l),l){case"textual_inversion":o="ti";break;case"hypernetworks":o="hyper";break;case"checkpoints":o="ckp";break;case"lora":o="lora"}for(const e of n){switch(e){case"textual_inversion":u="ti";break;case"hypernetworks":u="hyper";break;case"checkpoints":u="ckp";break;case"lora":u="lora"}if(u){if(u==o)if(console.log("handle active extra tab"),a=t+"_"+e+"_"+r,i=gradioApp().getElementById(a),i){g=i.querySelectorAll(".card");for(let e of g){if(c=e.querySelector(".button-row"),!c){console.log("can not find button_row");continue}let t=c.querySelectorAll("a");if(t&&t.length?console.log("find atags: "+t.length):(console.log("no atags"),p=!0),!p){console.log("do not need to add buttons");continue}if(s=e.querySelector(".actions .additional .search_term"),!s){console.log("can not find search_term node for cards in "+a);continue}if(d=s.innerHTML.trim(),!d){console.log("search_term is empty for cards in "+a);continue}console.log("adding buttons");let o=document.createElement("a");o.href="#",o.innerHTML="üåê",o.className="card-button",o.title="Open this model's civitai url",o.setAttribute("onclick","open_model_url(event, '"+u+"', '"+d+"')");let n=document.createElement("a");n.href="#",n.innerHTML="üí°",n.className="card-button",n.title="Add trigger words to prompt",n.setAttribute("onclick","add_trigger_words(event, '"+u+"', '"+d+"')");let r=document.createElement("a");r.href="#",r.innerHTML="üè∑Ô∏è",r.className="card-button",r.title="Use prompt from preview image",r.setAttribute("onclick","use_preview_prompt(event, '"+u+"', '"+d+"')");let l=document.createElement("a");l.href="#",l.innerHTML="‚ùå",l.className="card-button",l.title="Remove this model",l.setAttribute("onclick","remove_card(event, '"+u+"', '"+d+"')"),c.appendChild(o),c.appendChild(n),c.appendChild(r),c.appendChild(l)}}else console.log("can not find extra_network_node: "+a)}else console.log("can not get model_type from: "+e)}}}function a(){console.log("start update_card_for_civitai_with_sd1_8");let e=getTranslation("replace preview");e||(e="replace preview");let l="",a=null,i=null,c=null,s="",d="",u=null,g=!1,p=null,_=null,f="",m="",h=(0,t.getActiveTabType)();h||(h="txt2img");for(const e of o)if(e==h){p=gradioApp().getElementById(e+"_extra_tabs"),p||console.log("can not find extra_tabs: "+e+"_extra_tabs");for(const t of n){let o=gradioApp().getElementById(e+"_"+t);if(null!=o){if("block"==o.style.display){_=o,f=t;break}}else console.log(`can not get extra_tab: ${e}_${t}`)}switch(console.log("found active_model_type: "+f),f){case"textual_inversion":m="ti",d="ti";break;case"hypernetworks":m="hyper",d="hyper";break;case"checkpoints":m="ckp",d="ckp";break;case"lora":m="lora",d="lora"}if(d)if(console.log("handle active extra tab"),l=e+"_"+f+"_"+r,a=gradioApp().getElementById(l),a){u=a.querySelectorAll(".card"),console.log(`get cards: ${u.length}`);for(let e of u){if(console.log(`current card: ${e.dataset.name}`),i=e.querySelector(".button-row"),!i){console.log("can not find .button_row");continue}i.style.flexWrap="wrap";let t=i.querySelectorAll("a");if(t&&t.length?console.log("find atags: "+t.length):g=!0,!g){console.log("no need to add buttons");continue}if(c=e.querySelector(".actions .additional .search_terms"),!c){console.log("can not find search_term node for cards in "+l);continue}if(s=c.innerHTML.trim(),!s){console.log("search_term is empty for cards in "+l);continue}s=s.replaceAll("\\","\\\\"),console.log("adding buttons");let o=document.createElement("a");o.href="#",o.innerHTML="üåê",o.className="card-button",o.title="Open this model's civitai url",o.setAttribute("onclick","open_model_url(event, '"+d+"', '"+s+"')");let n=document.createElement("a");n.href="#",n.innerHTML="üí°",n.className="card-button",n.title="Add trigger words to prompt",n.setAttribute("onclick","add_trigger_words(event, '"+d+"', '"+s+"')");let r=document.createElement("a");r.href="#",r.innerHTML="üè∑Ô∏è",r.className="card-button",r.title="Use prompt from preview image",r.setAttribute("onclick","use_preview_prompt(event, '"+d+"', '"+s+"')");let a=document.createElement("a");a.href="#",a.innerHTML="‚ùå",a.className="card-button",a.title="Remove this model",a.setAttribute("onclick","remove_card(event, '"+d+"', '"+s+"')"),i.appendChild(o),i.appendChild(n),i.appendChild(r),i.appendChild(a)}}else console.log("can not find extra_network_node: "+l);else console.log("can not get model_type with: "+f)}console.log("end update_card_for_civitai_with_sd1_8")}let i="",c="",s="",d=null,u=null,g=null,p=null,_=(0,e.ch_sd_version)();if(console.log(`sd version is: ${_}`),_&&_>="1.8.0")for(let e of o){c=e+"_lora_controls";for(const t of n)c=e+"_"+t+"_controls",g=gradioApp().getElementById(c),s=e+"_"+t+"_extra_refresh",d=gradioApp().getElementById(s),d?d.onclick=function(o){console.log("run refresh button on click"),extraNetworksControlRefreshOnClick(o,e,t),a()}:console.log("can not find refresh_btn with id: "+s)}else{for(let e of o){if(i=e+"_extra_tabs",u=gradioApp().getElementById(i),p=gradioApp().getElementById("txt2img_lora_extra_refresh"),console.log("get extra_network_refresh_btn: "+p),!p){console.log("can not get extra network refresh button for "+i);continue}let t=document.createElement("button");t.innerHTML="üîÅ",t.title="Refresh Civitai Helper's additional buttons",t.className="lg secondary gradio-button",t.style.fontSize="200%",t.onclick=l;const o=p.parentNode;if(!o)return void console.error("can not find parrentNode for extra_network_refresh_btn");o.appendChild(t)}l()}}))})()})();