(()=>{"use strict";({187:function(){function e(){switch(globalThis.get_uiCurrentTabContent().id){case"tab_txt2img":return"txt2img";case"tab_img2img":return"img2img"}return null}this&&this.__awaiter,console.log("start civitai_helper.js"),globalThis.onUiLoaded((()=>{console.log("ui loaded");let t=["txt2img","img2img"],o=["textual_inversion","hypernetworks","checkpoints","lora"],l="cards";function n(){var n;let r=globalThis.getTranslation("replace preview");r||(r="replace preview");let a="",i=null,c=null,s=null,d="",g="",u=null,p=!1,m=e();m||(m="txt2img");for(const e of t){if(e!=m)continue;let t="";globalThis.gradioApp().getElementById(e+"_extra_tabs")||console.log("can not find extra_tabs: "+e+"_extra_tabs");const r=null===(n=Array.from(globalThis.get_uiCurrentTabContent().querySelectorAll(".extra-network-cards,.extra-network-thumbs")).find((e=>"block"===e.closest(".tabitem").style.display)))||void 0===n?void 0:n.id.match(/^(txt2img|img2img)_(.+)_cards$/)[2];switch(console.log("found active tab: "+r),r){case"textual_inversion":t="ti";break;case"hypernetworks":t="hyper";break;case"checkpoints":t="ckp";break;case"lora":t="lora"}for(const n of o){switch(n){case"textual_inversion":g="ti";break;case"hypernetworks":g="hyper";break;case"checkpoints":g="ckp";break;case"lora":g="lora"}if(g){if(g==t){console.log("handle active extra tab"),a=e+"_"+n+"_"+l,i=globalThis.gradioApp().getElementById(a),u=i.querySelectorAll(".card");for(let e of u){if(c=e.querySelector(".button-row"),!c){console.log("can not find button_row");continue}let t=c.querySelectorAll("a");if(t&&t.length?console.log("find atags: "+t.length):(console.log("no atags"),p=!0),!p){console.log("do not need to add buttons");continue}if(s=e.querySelector(".actions .additional .search_term"),!s){console.log("can not find search_term node for cards in "+a);continue}if(d=s.innerHTML.trim(),!d){console.log("search_term is empty for cards in "+a);continue}console.log("adding buttons");let o=document.createElement("a");o.href="#",o.innerHTML="üåê",o.className="card-button",o.title="Open this model's civitai url",o.setAttribute("onclick","open_model_url(event, '"+g+"', '"+d+"')");let l=document.createElement("a");l.href="#",l.innerHTML="üí°",l.className="card-button",l.title="Add trigger words to prompt",l.setAttribute("onclick","add_trigger_words(event, '"+g+"', '"+d+"')");let n=document.createElement("a");n.href="#",n.innerHTML="üè∑Ô∏è",n.className="card-button",n.title="Use prompt from preview image",n.setAttribute("onclick","use_preview_prompt(event, '"+g+"', '"+d+"')");let r=document.createElement("a");r.href="#",r.innerHTML="‚ùå",r.className="card-button",r.title="Remove this model",r.setAttribute("onclick","remove_card(event, '"+g+"', '"+d+"')"),c.appendChild(o),c.appendChild(l),c.appendChild(n),c.appendChild(r)}}}else console.log("can not get model_type from: "+n)}}}function r(){console.log("start update_card_for_civitai_with_sd1_8");let n=globalThis.getTranslation("replace preview");n||(n="replace preview");let r="",a=null,i=null,c=null,s="",d="",g=null,u=!1,p=null,m=null,f="",h="",_=e();_||(_="txt2img");for(const e of t)if(e==_){p=globalThis.gradioApp().getElementById(e+"_extra_tabs"),p||console.log("can not find extra_tabs: "+e+"_extra_tabs");for(const t of o){let o=globalThis.gradioApp().getElementById(e+"_"+t);if(null!=o){if("block"==o.style.display){m=o,f=t;break}}else console.log(`can not get extra_tab: ${e}_${t}`)}switch(console.log("found active_model_type: "+f),f){case"textual_inversion":h="ti",d="ti";break;case"hypernetworks":h="hyper",d="hyper";break;case"checkpoints":h="ckp",d="ckp";break;case"lora":h="lora",d="lora"}if(d){console.log("handle active extra tab"),r=e+"_"+f+"_"+l,a=globalThis.gradioApp().getElementById(r),g=a.querySelectorAll(".card"),console.log(`get cards: ${g.length}`);for(let e of g){if(console.log(`current card: ${e.dataset.name}`),i=e.querySelector(".button-row"),i.style.flexWrap="wrap",!i){console.log("can not find button_row");continue}let t=i.querySelectorAll("a");if(t&&t.length?console.log("find atags: "+t.length):u=!0,!u){console.log("no need to add buttons");continue}if(c=e.querySelector(".actions .additional .search_terms"),!c){console.log("can not find search_term node for cards in "+r);continue}if(s=c.innerHTML.trim(),!s){console.log("search_term is empty for cards in "+r);continue}s=s.replaceAll("\\","\\\\"),console.log("adding buttons");let o=document.createElement("a");o.href="#",o.innerHTML="üåê",o.className="card-button",o.title="Open this model's civitai url",o.setAttribute("onclick","open_model_url(event, '"+d+"', '"+s+"')");let l=document.createElement("a");l.href="#",l.innerHTML="üí°",l.className="card-button",l.title="Add trigger words to prompt",l.setAttribute("onclick","add_trigger_words(event, '"+d+"', '"+s+"')");let n=document.createElement("a");n.href="#",n.innerHTML="üè∑Ô∏è",n.className="card-button",n.title="Use prompt from preview image",n.setAttribute("onclick","use_preview_prompt(event, '"+d+"', '"+s+"')");let a=document.createElement("a");a.href="#",a.innerHTML="‚ùå",a.className="card-button",a.title="Remove this model",a.setAttribute("onclick","remove_card(event, '"+d+"', '"+s+"')"),i.appendChild(o),i.appendChild(l),i.appendChild(n),i.appendChild(a)}}else console.log("can not get model_type with: "+f)}console.log("end update_card_for_civitai_with_sd1_8")}let a="",i="",c="",s=null,d=null,g=null,u=null,p=function(){let e=globalThis.globalThis.gradioApp().getElementById("footer");if(!e)return null;let t=e.querySelector(".versions");if(!t)return null;let o=t.getElementsByTagName("a");return null==o||0==o.length?null:o[0].innerHTML.substring(1)}();if(console.log(`sd version is: ${p}`),p>="1.8.0")for(let e of t){i=e+"_lora_controls";for(const t of o)i=e+"_"+t+"_controls",g=globalThis.gradioApp().getElementById(i),c=e+"_"+t+"_extra_refresh",s=globalThis.gradioApp().getElementById(c),s?s.onclick=function(o){console.log("run refresh button on click"),globalThis.extraNetworksControlRefreshOnClick(o,e,t),r()}:console.log("can not find refresh_btn with id: "+c)}else{for(let e of t){if(a=e+"_extra_tabs",d=globalThis.gradioApp().getElementById(a),u=globalThis.gradioApp().getElementById("txt2img_lora_extra_refresh"),console.log("get extra_network_refresh_btn: "+u),!u){console.log("can not get extra network refresh button for "+a);continue}let t=document.createElement("button");t.innerHTML="üîÅ",t.title="Refresh Civitai Helper's additional buttons",t.className="lg secondary gradio-button",t.style.fontSize="200%",t.onclick=n,u.parentNode.appendChild(t)}n()}}))}})[187]()})();